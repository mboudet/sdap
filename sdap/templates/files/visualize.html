{% extends "base.html" %}
{% load static %}


{% block content %}
<div class="container">
    <div class="card mb-4 wow fadeIn">
        <div class="card-body d-sm-flex justify-content-between">
            <h4 class="mb-2 mb-sm-0 pt-1">
                <span>
                    Path: 
                    <a href="{% url 'files:index'%}" style="text-decoration: none;">home</a>/
                    {% for folder in previous_folders %}
                        <a href="{% url 'files:subindex' folder.id %}" style="text-decoration: none;">{{folder.name}}</a>/
                    {% endfor %}
                    <a href="{% url 'files:view_file' file.id %}" style="text-decoration: none;">{{ file.name }}</a>
                </span>
            </h4>
        </div>
    </div>
    
    <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item">
            <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home"
            aria-selected="true">Overview</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab" aria-controls="profile"
            aria-selected="false">Visualize</a>
        </li>
    </ul>
    <div class="tab-content" id="myTabContent">
        <!-- Overview -->
        <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
            <div class="row m-y-2">
                <div class="col-lg-4 pull-lg-8 text-xs-center">
                    <table class="table table-striped">
                        <tbody>
                            <tr>
                                <th scope="row">Creation date</th>
                                <td>{{ file.created_at }}</td>
                            </tr>
                            <tr>
                                <th scope="row">Descriptionn</th>
                                <td>{{ file.description }}</td>
                            </tr>
                            <tr>
                                <th scope="row">Type</th>
                                <td>{{ file.get_type_display }}</td>
                            </tr>
                            <tr>
                                <th scope="row">Size</th>
                                <td>{{ file.file.size | filesizeformat}}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="col-lg-8 pull-lg-8 text-xs-center">
                    {% if file.type == 'CSV' or file.type == 'TEXT'%}
                        {{ data | safe }}
                    {% endif %}
                    {% if file.type == 'PDF' %}
                        <embed src="{{ file.file.url }}" width="100%" height="500px" type="application/pdf">
                    {% endif %}
                    {% if file.type == 'IMAGE' %}
                        <img src="{{ file.file.url }}" width='100%'>
                    {% endif %}

                </div>
            </div>
        </div>
        <!-- Overview -->

        <!-- Visualize -->
        <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">
            <h3>Please select a visualization type for the file {{file.name}} </h3>
            <form id="visu_type" data-url="{% url 'files:get_visualization' file.id %}">
                <select id="visu_type_select" class="select form-control">
                    <option disabled selected value> -- Select a type -- </option>
                    {% for type in types %}
                        <option value="{{type}}">{{type}}</option>
                    {% endfor %}
                </select>
            </form>
            <br>
            <div id="visu_params" style="display:none; text-align:center;">
                <button class='btn btn-info' id='transpose' style="display:none">Transpose</button><br>
                <div id="data_table" class="table-responsive"></div>
                <div id="params"></div>
                <button type="button" class="btn btn-success" id="visualize_button" data-url="{% url 'files:get_visualization' file.id %}">Visualize!</button>
            </div>
            <div id="visu_results"></div>
        </div>
        <!-- Visualize -->
    </div>
</div>
{% endblock %}


{% block javascript %}
    {{ block.super }}
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="{% static 'js/visualize.js' %}"></script>
{% endblock %} 
